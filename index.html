<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delhi-NCR Air Quality Monitor</title>
    <meta name="description" content="Advanced air quality monitoring with real-time data and complaint management">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        :root {
            --primary: #0d6efd;
            --secondary: #6c757d;
            --success: #198754;
            --info: #0dcaf0;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #212529;
            --sidebar-width: 280px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            overflow-x: hidden;
        }
        
        /* Modern Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            margin-bottom: 30%;
            z-index: 1000;
            width: 100%;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.4rem;
            margin-right: 15px;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        
        .menu-toggle:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.3rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .logo-icon {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 8px;
            margin-right: 10px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            flex: 1;
        }
        
        .header-icon {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            margin-left: 12px;
            cursor: pointer;
            position: relative;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        
        .header-icon:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
        }
        
        /* Modern Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: var(--sidebar-width);
            height: 100vh;
            background: white;
            box-shadow: 2px 0 15px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 999;
            overflow-y: auto;
            padding-top: 70px;
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 998;
            display: none;
        }
        
        .sidebar-overlay.open {
            display: block;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 0;
        }
        
        .sidebar-menu li {
            border-bottom: 1px solid #f0f0f0;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: linear-gradient(135deg, #f0f5ff 0%, #e6f0ff 100%);
            color: var(--primary);
            border-left: 4px solid var(--primary);
        }
        
        .sidebar-menu i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            transition: margin-left 0.3s;
        }
        
        /* Modern Cards */
        .dashboard-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid #f0f0f0;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
        
        .card-header {
            padding: 18px 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #eee;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: between;
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* AQI Colors */
        .aqi-good { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
        .aqi-satisfactory { background: linear-gradient(135deg, #87c159 0%, #6da53c 100%); color: white; }
        .aqi-moderate { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: black; }
        .aqi-poor { background: linear-gradient(135deg, #fd7e14 0%, #e8590c 100%); color: white; }
        .aqi-very-poor { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; }
        .aqi-severe { background: linear-gradient(135deg, #6f42c1 0%, #5a2d9c 100%); color: white; }
        
        /* Maps */
        .map-container {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* Photo Capture */
        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .photo-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-submitted { background: #6c757d; color: white; }
        .status-in-progress { background: #0dcaf0; color: black; }
        .status-under-investigation { background: #ffc107; color: black; }
        .status-resolved { background: #198754; color: white; }
        .status-rejected { background: #dc3545; color: white; }
        
        .priority-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .priority-low { background: #6c757d; color: white; }
        .priority-medium { background: #ffc107; color: black; }
        .priority-high { background: #fd7e14; color: white; }
        .priority-critical { background: #dc3545; color: white; }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Real-time Indicator */
        .real-time-indicator {
            display: inline-flex;
            align-items: center;
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .real-time-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }
        
        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 60px;
            right: -350px;
            width: 320px;
            height: calc(100vh - 60px);
            background: white;
            box-shadow: -2px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 997;
            padding: 20px;
            overflow-y: auto;
        }
        
        .notification-panel.open {
            right: 0;
        }
        
        .notification-item {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .notification-item:hover {
            background-color: #f8f9fa;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        /* Profile Panel */
        .profile-panel {
            position: fixed;
            top: 60px;
            right: -350px;
            width: 320px;
            height: calc(100vh - 60px);
            background: white;
            box-shadow: -2px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 997;
            padding: 20px;
            overflow-y: auto;
        }
        
        .profile-panel.open {
            right: 0;
        }
        
        .profile-header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 15px;
        }
        
        /* Content Sections */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Progress Bars */
        .progress {
            height: 10px;
            border-radius: 5px;
        }
        
        .progress-bar {
            border-radius: 5px;
        }
        
        /* Responsive */
        @media (min-width: 768px) {
            .app-container {
                flex-direction: row;
            }
            
            .sidebar {
                position: static;
                width: var(--sidebar-width);
                height: 100vh;
                left: 0;
            }
            
            .main-content {
                flex: 1;
                margin-left: 0;
            }
            
            .menu-toggle {
                display: none;
            }
            
            .sidebar-overlay {
                display: none !important;
            }
        }
        
        @media (max-width: 767px) {
            .sidebar {
                width: 85%;
                max-width: 300px;
            }
            
            .app-header {
                padding: 10px 15px;
            }
            
            .logo {
                font-size: 1.1rem;
            }
            
            .header-icon {
                margin-left: 8px;
                font-size: 1.1rem;
            }
            
            .menu-toggle {
                margin-right: 8px;
                font-size: 1.2rem;
            }
            
            .main-content {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .app-header {
                padding: 8px 12px;
            }
            
            .logo {
                font-size: 1rem;
            }
            
            .header-icon {
                margin-left: 6px;
                font-size: 1rem;
            }
            
            .menu-toggle {
                margin-right: 6px;
                font-size: 1.1rem;
            }
            
            .main-content {
                padding: 10px;
            }
        }

        /* Authentication */
        .auth-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 30px auto;
            max-width: 500px;
            border: 1px solid #f0f0f0;
        }
        
        .auth-header {
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            background: #f8f9fa;
        }
        
        .auth-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .auth-content {
            padding: 30px;
        }
        
        /* Camera Styles */
        .camera-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .camera-preview {
            width: 100%;
            height: 300px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .camera-preview video, .camera-preview canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Tracking Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e9ecef;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid white;
        }
        
        /* Statistics Cards */
        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* Password Toggle */
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            z-index: 10;
        }
        
        .form-floating {
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10 col-lg-8">
                    <div class="auth-container">
                        <div class="auth-header">
                            <h1><i class="fas fa-wind me-2"></i>AQI Monitor Delhi-NCR</h1>
                            <p class="mb-0">Advanced air quality monitoring with real-time data</p>
                        </div>
                        
                        <div class="auth-tabs">
                            <div class="auth-tab active" id="login-tab">Login</div>
                            <div class="auth-tab" id="register-tab">Register</div>
                        </div>
                        
                        <div class="auth-content">
                            <!-- Login Form -->
                            <div id="login-form" class="auth-panel">
                                <h3 class="text-center mb-4">Login to Your Account</h3>
                                
                                <div class="alert alert-info">
                                    <strong>Demo Account:</strong> username: demo | password: demo123
                                </div>
                                
                                <form id="loginForm">
                                    <div class="mb-3">
                                        <label for="loginUsername" class="form-label">Username</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            <input type="text" class="form-control" id="loginUsername" placeholder="Enter your username" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="loginPassword" class="form-label">Password</label>
                                        <div class="form-floating">
                                            <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                                            <span class="password-toggle" onclick="togglePassword('loginPassword')">
                                                <i class="fas fa-eye"></i>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberMe">
                                        <label class="form-check-label" for="rememberMe">Remember me</label>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <span id="login-spinner" class="loading-spinner" style="display: none;"></span>
                                            Login
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Registration Form -->
                            <div id="register-form" class="auth-panel" style="display: none;">
                                <h3 class="text-center mb-4">Create Your Account</h3>
                                
                                <form id="registrationForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="fullName" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="fullName" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="username" class="form-label">Username</label>
                                            <input type="text" class="form-control" id="username" required>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">Email Address</label>
                                            <input type="email" class="form-control" id="email" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="mobile" class="form-label">Mobile Number</label>
                                            <input type="tel" class="form-control" id="mobile" required>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="password" class="form-label">Password</label>
                                            <div class="form-floating">
                                                <input type="password" class="form-control" id="password" required>
                                                <span class="password-toggle" onclick="togglePassword('password')">
                                                    <i class="fas fa-eye"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="confirmPasswordReg" class="form-label">Confirm Password</label>
                                            <div class="form-floating">
                                                <input type="password" class="form-control" id="confirmPasswordReg" required>
                                                <span class="password-toggle" onclick="togglePassword('confirmPasswordReg')">
                                                    <i class="fas fa-eye"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="terms" required>
                                        <label class="form-check-label" for="terms">I agree to the Terms of Service and Privacy Policy</label>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <span id="register-spinner" class="loading-spinner" style="display: none;"></span>
                                            Create Account
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard-section" class="app-container" style="display: none;">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#" data-section="complaints"><i class="fas fa-exclamation-triangle"></i> Submit Complaint</a></li>
                <li><a href="#" data-section="tracking"><i class="fas fa-tasks"></i> Complaint Tracking</a></li>
                <li><a href="#" data-section="map"><i class="fas fa-map-marked-alt"></i> AQI Map</a></li>
                <li><a href="#" data-section="hospitals"><i class="fas fa-hospital"></i> Nearby Hospitals</a></li>
                <li><a href="#" data-section="analytics"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                <li><a href="#" data-section="profile"><i class="fas fa-user-cog"></i> Profile Settings</a></li>
                <li><a href="#" id="logout-sidebar"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </aside>
        
        <!-- Main Content Area -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-wind"></i>
                        </div>
                        AQI Monitor
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-icon" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </button>
                    <button class="header-icon" id="profileBtn">
                        <i class="fas fa-user"></i>
                    </button>
                </div>
            </header>
            
            <!-- Dashboard Content -->
            <section class="content-section active" id="dashboard-section-content">
                <!-- Header Section -->
                <div class="row mb-4">
                    <div class="col-12 text-center">
                      <br>
                      <br>
                      <br>
                        <h1 class="display-5 fw-bold text-primary">Air Quality Dashboard</h1>
                        <p class="lead text-muted">Real-time monitoring & health recommendations</p>
                        <div class="d-flex justify-content-center align-items-center">
                            <small class="text-muted">Last updated: <span id="lastUpdated">Loading...</span></small>
                            <span class="real-time-indicator">Live</span>
                        </div>
                    </div>
                </div>

                <!-- Alert Section -->
                <div class="row mb-4" id="healthAlert" style="display: none;">
                    <div class="col-12">
                        <div class="alert alert-warning d-flex align-items-center" role="alert">
                            <i class="fas fa-exclamation-triangle me-3 fa-2x"></i>
                            <div>
                                <h5 class="alert-heading mb-1" id="alertTitle">Health Alert</h5>
                                <p class="mb-0" id="alertMessage">Current air quality may affect sensitive individuals.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main AQI Display -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-body text-center py-4">
                                <h3 class="text-muted mb-3">Current AQI - Delhi NCR</h3>
                                <div class="display-1 fw-bold mb-3" id="mainAQI">--</div>
                                <div class="badge fs-5 px-4 py-2 mb-4" id="mainAQICategory">Loading...</div>
                                <div class="progress mb-3" style="height: 12px;">
                                    <div class="progress-bar" role="progressbar" id="aqiProgress"></div>
                                </div>
                                <p class="text-muted mb-2" id="aqiDescription">Fetching real-time data...</p>
                                <p class="text-muted small" id="dominantPollutant"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weather & Pollutant Stats -->
                <div class="row mb-4">
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-thermometer-half fa-2x text-info mb-3"></i>
                                <h5>Temperature</h5>
                                <div class="h4 fw-bold" id="temperature">--°C</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-wind fa-2x text-primary mb-3"></i>
                                <h5>Wind Speed</h5>
                                <div class="h4 fw-bold" id="windSpeed">-- m/s</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-tint fa-2x text-success mb-3"></i>
                                <h5>Humidity</h5>
                                <div class="h4 fw-bold" id="humidity">--%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-eye fa-2x text-warning mb-3"></i>
                                <h5>Visibility</h5>
                                <div class="h4 fw-bold" id="visibility">-- km</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pollutant Breakdown -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h4 class="mb-0"><i class="fas fa-flask me-2"></i>Pollutant Levels</h4>
                            </div>
                            <div class="card-body">
                                <div class="row" id="pollutantLevels">
                                    <div class="col-12 text-center">
                                        <div class="loading-spinner"></div>
                                        <p>Loading pollutant data...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health Recommendations -->
                <div class="row mb-4">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-header bg-success text-black">
                                <h5 class="mb-0"><i class="fas fa-heart me-2"></i>Health Recommendations</h5>
                            </div>
                            <div class="card-body">
                                <div id="healthRecommendations">
                                    <p>Loading health recommendations based on current AQI...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="dashboard-card h-100">
                            <div class="card-header bg-info text-black">
                                <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Activity Suggestions</h5>
                            </div>
                            <div class="card-body">
                                <div id="activitySuggestions">
                                    <p>Loading activity suggestions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Submit Complaint Section -->
            <section class="content-section" id="complaints-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                      <br>
                      <br>
                      <br>
                        <h2 class="fw-bold text-primary"><i class="fas fa-exclamation-triangle me-2"></i>Submit Complaint</h2>
                        <p class="text-muted">Report environmental violations with photo evidence</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 col-lg-8">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Complaint Details</h5>
                            </div>
                            <div class="card-body">
                                <form id="complaintForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Complaint Type</label>
                                            <select class="form-select" id="complaintType" required>
                                                <option value="">Select type</option>
                                                <option value="construction">Illegal Construction</option>
                                                <option value="stubble">Stubble Burning</option>
                                                <option value="industry">Illegal Industry</option>
                                                <option value="vehicle">Vehicle Pollution</option>
                                                <option value="waste">Waste Burning</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Severity Level</label>
                                            <select class="form-select" id="complaintSeverity" required>
                                                <option value="Low">Low</option>
                                                <option value="Medium" selected>Medium</option>
                                                <option value="High">High</option>
                                                <option value="Critical">Critical</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Location</label>
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="complaintLocation" placeholder="Enter location or use current location" required>
                                            <button type="button" class="btn btn-outline-primary" id="getCurrentLocation">
                                                <i class="fas fa-location-arrow"></i>
                                            </button>
                                        </div>
                                        <div id="locationMap" class="map-container mb-2" style="height: 200px; display: none;"></div>
                                        <small class="text-muted" id="locationCoordinates"></small>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Area Affected</label>
                                        <input type="text" class="form-control" id="areaAffected" placeholder="e.g., Residential area, Park, School zone">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">People Affected (Approx.)</label>
                                        <input type="number" class="form-control" id="peopleAffected" placeholder="Estimated number of people affected">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control" id="complaintDescription" rows="4" placeholder="Describe the issue in detail including time, impact, and any other relevant information" required></textarea>
                                    </div>

                                    <!-- Photo Capture Section -->
                                    <div class="mb-3">
                                        <label class="form-label">Evidence Photos</label>
                                        <div class="camera-container">
                                            <div class="camera-preview" id="cameraPreview">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-camera fa-3x mb-3"></i>
                                                    <p>Click to capture photos</p>
                                                </div>
                                            </div>
                                            <div class="d-flex gap-2">
                                                <button type="button" class="btn btn-outline-primary flex-fill" id="startCamera">
                                                    <i class="fas fa-camera me-2"></i>Start Camera
                                                </button>
                                                <button type="button" class="btn btn-success flex-fill" id="capturePhoto" style="display: none;">
                                                    <i class="fas fa-camera me-2"></i>Capture Photo
                                                </button>
                                            </div>
                                        </div>
                                        <div class="photo-preview" id="photoPreview"></div>
                                        <small class="text-muted">Capture clear photos showing the violation. Maximum 5 photos allowed.</small>
                                    </div>

                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <span id="complaint-spinner" class="loading-spinner" style="display: none;"></span>
                                        Submit Complaint
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-lg-4">
                        <div class="dashboard-card">
                            <div class="card-header bg-info text-black">
                                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Complaint Guidelines</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="mb-3">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Clear Photos:</strong> Capture multiple angles showing the violation clearly
                                    </li>
                                    <li class="mb-3">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Accurate Location:</strong> Use GPS for precise location mapping
                                    </li>
                                    <li class="mb-3">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Detailed Description:</strong> Include time, impact, and relevant details
                                    </li>
                                    <li class="mb-3">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Severity Assessment:</strong> Choose appropriate severity level
                                    </li>
                                </ul>
                                <div class="alert alert-warning mt-3">
                                    <small>
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Note:</strong> False complaints may lead to account suspension. Ensure all information is accurate.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card mt-4">
                            <div class="card-header bg-success text-black">
                                <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Privacy & Safety</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-lock text-success me-2"></i>
                                        Your personal information is protected
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-user-shield text-success me-2"></i>
                                        Complaints are handled by authorized officers
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-history text-success me-2"></i>
                                        Track complaint status in real-time
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-phone text-success me-2"></i>
                                        Emergency support available 24/7
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Complaint Tracking Section -->
            <section class="content-section" id="tracking-section-content">
             
                <div class="row mb-4">
                    <div class="col-12">
                      <br>
                      <br>
                      <br>
                        <h2 class="fw-bold text-primary"><i class="fas fa-tasks me-2"></i>Complaint Tracking</h2>
                        <p class="text-muted">Monitor your complaint status and tracking history</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 col-lg-8">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Your Complaints</h5>
                            </div>
                            <div class="card-body">
                                <div id="complaintsList">
                                    <div class="text-center text-muted py-4">
                                        <div class="loading-spinner"></div>
                                        <p>Loading your complaints...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-lg-4">
                        <div class="dashboard-card">
                            <div class="card-header bg-info text-black">
                                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Complaint Statistics</h5>
                            </div>
                            <div class="card-body">
                                <div id="complaintStats">
                                    <div class="text-center text-muted">
                                        <div class="loading-spinner"></div>
                                        <p>Loading statistics...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card mt-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary" onclick="showSection('complaints')">
                                        <i class="fas fa-plus me-2"></i>New Complaint
                                    </button>
                                    <button class="btn btn-outline-info" id="refreshComplaints">
                                        <i class="fas fa-sync-alt me-2"></i>Refresh Status
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AQI Map Section -->
            <section class="content-section" id="map-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                      <br>
                      <br>
                      <br>
                        <h2 class="fw-bold text-primary"><i class="fas fa-map-marked-alt me-2"></i>AQI Map</h2>
                        <p class="text-muted">Real-time air quality across Delhi-NCR</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Delhi-NCR Air Quality Index Map</h5>
                            </div>
                            <div class="card-body">
                                <div id="aqiMap" class="map-container"></div>
                                <div class="row mt-3">
                                    <div class="col-6 col-md-2 text-center mb-2">
                                        <div class="aqi-legend aqi-good p-2 mb-1">0-50</div>
                                        <small>Good</small>
                                    </div>
                                    <div class="col-6 col-md-2 text-center mb-2">
                                        <div class="aqi-legend aqi-satisfactory p-2 mb-1">51-100</div>
                                        <small>Satisfactory</small>
                                    </div>
                                    <div class="col-6 col-md-2 text-center mb-2">
                                        <div class="aqi-legend aqi-moderate p-2 mb-1">101-200</div>
                                        <small>Moderate</small>
                                    </div>
                                    <div class="col-6 col-md-2 text-center mb-2">
                                        <div class="aqi-legend aqi-poor p-2 mb-1">201-300</div>
                                        <small>Poor</small>
                                    </div>
                                    <div class="col-6 col-md-2 text-center mb-2">
                                        <div class="aqi-legend aqi-very-poor p-2 mb-1">301-400</div>
                                        <small>Very Poor</small>
                                    </div>
                                    <div class="col-6 col-md-2 text-center mb-2">
                                        <div class="aqi-legend aqi-severe p-2 mb-1">401+</div>
                                        <small>Severe</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12 col-md-6">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Map Legend</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="bg-primary rounded-circle me-2" style="width: 15px; height: 15px;"></div>
                                            <small>Monitoring Station</small>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="bg-warning rounded-circle me-2" style="width: 15px; height: 15px;"></div>
                                            <small>Complaint Location</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="bg-success rounded-circle me-2" style="width: 15px; height: 15px;"></div>
                                            <small>Hospital</small>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="bg-danger rounded-circle me-2" style="width: 15px; height: 15px;"></div>
                                            <small>Your Location</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-cog me-2"></i>Map Controls</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary" id="locateMe">
                                        <i class="fas fa-location-arrow me-2"></i>Locate Me
                                    </button>
                                    <button class="btn btn-outline-info" id="refreshMap">
                                        <i class="fas fa-sync-alt me-2"></i>Refresh Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Nearby Hospitals Section -->
            <section class="content-section" id="hospitals-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                      <br>
                      <br>
                      <br>
                        <h2 class="fw-bold text-primary"><i class="fas fa-hospital me-2"></i>Nearby Hospitals</h2>
                        <p class="text-muted">Find healthcare facilities near you</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 col-lg-8">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Healthcare Facilities</h5>
                            </div>
                            <div class="card-body">
                                <div id="hospitalsList">
                                    <div class="text-center text-muted py-4">
                                        <div class="loading-spinner"></div>
                                        <p>Loading nearby hospitals...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-lg-4">
                        <div class="dashboard-card">
                            <div class="card-header bg-info text-black">
                                <h5 class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Hospital Map</h5>
                            </div>
                            <div class="card-body">
                                <div id="hospitalsMap" class="map-container" style="height: 300px;"></div>
                            </div>
                        </div>

                        <div class="dashboard-card mt-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filter Options</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Search Radius</label>
                                    <select class="form-select" id="hospitalRadius">
                                        <option value="5">5 km</option>
                                        <option value="10" selected>10 km</option>
                                        <option value="20">20 km</option>
                                        <option value="30">30 km</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Speciality</label>
                                    <select class="form-select" id="hospitalSpeciality">
                                        <option value="all">All Specialities</option>
                                        <option value="emergency">Emergency</option>
                                        <option value="respiratory">Respiratory</option>
                                        <option value="cardiology">Cardiology</option>
                                        <option value="general">General Medicine</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary w-100" id="refreshHospitals">
                                    <i class="fas fa-sync-alt me-2"></i>Refresh List
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section class="content-section" id="analytics-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                      <br>
                      <br>
                      <br>
                        <h2 class="fw-bold text-primary"><i class="fas fa-chart-bar me-2"></i>Analytics Dashboard</h2>
                        <p class="text-muted">Comprehensive insights and statistics</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-6 col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-number text-primary" id="totalComplaints">0</div>
                            <div class="stat-label">Total Complaints</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-number text-success" id="resolvedComplaints">0</div>
                            <div class="stat-label">Resolved Complaints</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-number text-warning" id="pendingComplaints">0</div>
                            <div class="stat-label">Pending Complaints</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-number text-info" id="resolutionRate">0%</div>
                            <div class="stat-label">Resolution Rate</div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 col-lg-6 mb-4">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Complaints by Type</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="complaintsByTypeChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-4">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Complaints by Status</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="complaintsByStatusChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 col-lg-8 mb-4">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">AQI Trends (Last 7 Days)</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="aqiTrendChart" height="150"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4 mb-4">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary" id="exportData">
                                        <i class="fas fa-download me-2"></i>Export Data
                                    </button>
                                    <button class="btn btn-outline-info" id="refreshAnalytics">
                                        <i class="fas fa-sync-alt me-2"></i>Refresh Analytics
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Settings Section -->
            <section class="content-section" id="profile-section-content">
                <div class="row mb-4">
                    <div class="col-12">
                      <br>
                      <br>
                      <br>
                        <h2 class="fw-bold text-primary"><i class="fas fa-user-cog me-2"></i>Profile Settings</h2>
                        <p class="text-muted">Manage your account and preferences</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 col-lg-8">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="mb-0">Personal Information</h5>
                            </div>
                            <div class="card-body">
                                <form id="profileForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="profileFullName" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Username</label>
                                            <input type="text" class="form-control" id="profileUsername" readonly>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Email Address</label>
                                            <input type="email" class="form-control" id="profileEmail" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Mobile Number</label>
                                            <input type="tel" class="form-control" id="profileMobile" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Address</label>
                                        <textarea class="form-control" id="profileAddress" rows="3"></textarea>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">City</label>
                                            <input type="text" class="form-control" id="profileCity">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">State</label>
                                            <input type="text" class="form-control" id="profileState">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Pincode</label>
                                            <input type="text" class="form-control" id="profilePincode">
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <span id="profile-spinner" class="loading-spinner" style="display: none;"></span>
                                        Update Profile
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="dashboard-card mt-4">
                            <div class="card-header">
                                <h5 class="mb-0">Health Profile</h5>
                            </div>
                            <div class="card-body">
                                <form id="healthProfileForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Respiratory Condition</label>
                                            <select class="form-select" id="respiratoryCondition">
                                                <option value="none">None</option>
                                                <option value="asthma">Asthma</option>
                                                <option value="copd">COPD</option>
                                                <option value="bronchitis">Bronchitis</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Age Group</label>
                                            <select class="form-select" id="ageGroup">
                                                <option value="child">Below 18</option>
                                                <option value="young">18-35</option>
                                                <option value="middle">36-60</option>
                                                <option value="senior">Above 60</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Activity Level</label>
                                            <select class="form-select" id="activityLevel">
                                                <option value="sedentary">Sedentary</option>
                                                <option value="light">Light Activity</option>
                                                <option value="moderate">Moderate Activity</option>
                                                <option value="active">Active</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Blood Group</label>
                                            <select class="form-select" id="bloodGroup">
                                                <option value="">Not Specified</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Emergency Contact</label>
                                        <input type="text" class="form-control" id="emergencyContact" placeholder="Name and phone number">
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="cardiovascularCondition">
                                        <label class="form-check-label" for="cardiovascularCondition">Cardiovascular Condition</label>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="smoker">
                                        <label class="form-check-label" for="smoker">Smoker</label>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <span id="health-spinner" class="loading-spinner" style="display: none;"></span>
                                        Update Health Profile
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-lg-4">
                        <div class="dashboard-card">
                            <div class="card-header bg-info text-black">
                                <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Notification Preferences</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3 form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                    <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                                </div>
                                <div class="mb-3 form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="smsNotifications">
                                    <label class="form-check-label" for="smsNotifications">SMS Notifications</label>
                                </div>
                                <div class="mb-3 form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="aqiAlerts" checked>
                                    <label class="form-check-label" for="aqiAlerts">AQI Health Alerts</label>
                                </div>
                                <div class="mb-3 form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="complaintUpdates" checked>
                                    <label class="form-check-label" for="complaintUpdates">Complaint Updates</label>
                                </div>
                                <button class="btn btn-outline-primary w-100" id="saveNotifications">
                                    Save Preferences
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card mt-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Account Security</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-info" id="changePassword">
                                        <i class="fas fa-key me-2"></i>Change Password
                                    </button>
                                    <button class="btn btn-outline-danger" id="deleteAccount">
                                        <i class="fas fa-trash me-2"></i>Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
        </div>
        
        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Notifications</h5>
                <button class="btn btn-sm btn-outline-secondary" id="markAllRead">
                    <i class="fas fa-check-double me-1"></i>Mark All Read
                </button>
            </div>
            <div id="notificationPanelContent">
                <div class="text-center text-muted py-4">
                    <p>Loading notifications...</p>
                </div>
            </div>
        </div>
        
        <!-- Profile Panel -->
        <div class="profile-panel" id="profilePanel">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h5 id="profileUserName">User</h5>
                <p class="text-muted" id="profileUserLocation">Delhi, India</p>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <i class="fas fa-user me-2"></i>Edit Profile
                </li>
                <li class="list-group-item">
                    <i class="fas fa-bell me-2"></i>Notification Settings
                </li>
                <li class="list-group-item">
                    <i class="fas fa-shield-alt me-2"></i>Privacy & Security
                </li>
                <li class="list-group-item">
                    <i class="fas fa-question-circle me-2"></i>Help & Support
                </li>
                <li class="list-group-item text-danger" id="logout-profile">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </li>
            </ul>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Backend Service Integration
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbyoNzGHea-kGugUulTvsXMsjbAVs-2_4OPGvLiOaiJe8o7-3PBbt5_pyBE3aMM74ykG/exec';

        class BackendService {
            constructor() {
                this.baseUrl = BACKEND_URL;
            }

            async makeRequest(params) {
                try {
                    const queryString = Object.keys(params)
                        .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                        .join('&');
                    
                    const url = `${this.baseUrl}?${queryString}`;
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        mode: 'cors'
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Backend request failed:', error);
                    // Return mock data for demo purposes
                    return this.getMockData(params.action, params);
                }
            }

            getMockData(action, params) {
                switch(action) {
                    case 'login':
                        if (params.username === 'demo' && params.password === 'demo123') {
                            return {
                                success: true,
                                userData: {
                                    userID: 'USR001',
                                    username: 'demo',
                                    fullName: 'Demo User',
                                    email: 'demo@example.com',
                                    mobile: '9876543210',
                                    city: 'Delhi',
                                    state: 'Delhi'
                                }
                            };
                        }
                        return { success: false, error: 'Invalid credentials' };
                    
                    case 'register':
                        return {
                            success: true,
                            userData: {
                                userID: 'USR' + Math.floor(1000 + Math.random() * 9000),
                                ...params
                            }
                        };
                    
                    case 'getAQIData':
                        return {
                            success: true,
                            data: {
                                aqi: Math.floor(150 + Math.random() * 200),
                                pm25: Math.floor(80 + Math.random() * 100),
                                pm10: Math.floor(120 + Math.random() * 150),
                                o3: Math.floor(30 + Math.random() * 50),
                                no2: Math.floor(20 + Math.random() * 40),
                                so2: Math.floor(5 + Math.random() * 15),
                                co: (1 + Math.random() * 2).toFixed(1),
                                dominantPollutant: 'PM2.5',
                                healthMessage: 'Air quality is unhealthy for sensitive groups. Reduce outdoor activities.'
                            },
                            weather: {
                                temperature: Math.floor(25 + Math.random() * 10),
                                humidity: Math.floor(40 + Math.random() * 30),
                                windSpeed: (2 + Math.random() * 5).toFixed(1),
                                visibility: (5 + Math.random() * 10).toFixed(1)
                            }
                        };
                    
                    case 'submitComplaint':
                        return {
                            success: true,
                            complaintID: 'CMP' + Math.floor(1000 + Math.random() * 9000),
                            assignedOfficer: 'Officer Raj Kumar',
                            assignedDepartment: 'Pollution Control Board'
                        };
                    
                    case 'getUserComplaints':
                        const complaints = [
                            {
                                complaintID: 'CMP1001',
                                type: 'construction',
                                description: 'Illegal construction causing dust pollution in residential area',
                                status: 'In Progress',
                                priority: 'High',
                                submittedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                                officerAssigned: 'Officer Raj Kumar',
                                location: { lat: 28.6139, lng: 77.2090 },
                                photoURLs: []
                            },
                            {
                                complaintID: 'CMP1002',
                                type: 'stubble',
                                description: 'Farmers burning crop residue in nearby fields',
                                status: 'Under Investigation',
                                priority: 'Critical',
                                submittedAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                                officerAssigned: 'Officer Priya Singh',
                                location: { lat: 28.7041, lng: 77.1025 },
                                photoURLs: []
                            }
                        ];
                        return { success: true, complaints };
                    
                    case 'getComplaintStats':
                        return {
                            success: true,
                            stats: {
                                total: 15,
                                resolved: 8,
                                pending: 5,
                                resolutionRate: 53
                            }
                        };
                    
                    case 'getSystemAnalytics':
                        return {
                            success: true,
                            analytics: {
                                totalComplaints: 15,
                                resolvedComplaints: 8,
                                pendingComplaints: 5,
                                resolutionRate: '53%',
                                complaintsByType: {
                                    construction: 5,
                                    stubble: 4,
                                    industry: 3,
                                    vehicle: 2,
                                    waste: 1
                                },
                                complaintsByStatus: {
                                    submitted: 2,
                                    'in-progress': 3,
                                    'under-investigation': 2,
                                    resolved: 8
                                },
                                aqiTrend: [156, 178, 192, 205, 189, 174, 162]
                            }
                        };
                    
                    case 'getNotifications':
                        return {
                            success: true,
                            notifications: [
                                {
                                    id: '1',
                                    title: 'Complaint Assigned',
                                    message: 'Your complaint CMP1001 has been assigned to Officer Raj Kumar',
                                    type: 'assignment',
                                    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
                                },
                                {
                                    id: '2',
                                    title: 'Health Alert',
                                    message: 'High AQI levels detected in your area. Limit outdoor activities.',
                                    type: 'health_alert',
                                    createdAt: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString()
                                }
                            ]
                        };
                    
                    case 'getHospitals':
                        const hospitals = [
                            {
                                id: 'HOS001',
                                name: 'AIIMS Delhi',
                                address: 'Ansari Nagar, New Delhi',
                                lat: 28.5676,
                                lng: 77.2105,
                                phone: '011-26588585',
                                beds: 2500,
                                oxygen: true,
                                icu: 150,
                                distance: '2.5 km',
                                speciality: 'Multi-speciality'
                            },
                            {
                                id: 'HOS002',
                                name: 'Safdarjung Hospital',
                                address: 'Ansari Nagar East, New Delhi',
                                lat: 28.5670,
                                lng: 77.2070,
                                phone: '011-26763000',
                                beds: 1800,
                                oxygen: true,
                                icu: 120,
                                distance: '3.2 km',
                                speciality: 'General Medicine'
                            }
                        ];
                        return { success: true, hospitals };
                    
                    case 'getHealthProfile':
                        return {
                            success: true,
                            healthProfile: {
                                respiratoryCondition: 'none',
                                cardiovascularCondition: false,
                                smoker: false,
                                activityLevel: 'moderate',
                                ageGroup: 'young',
                                bloodGroup: 'O+',
                                emergencyContact: 'John Doe - 9876543210'
                            }
                        };
                    
                    default:
                        return { success: false, error: 'Action not supported' };
                }
            }

            async register(userData) {
                return await this.makeRequest({
                    action: 'register',
                    data: JSON.stringify(userData)
                });
            }

            async login(username, password) {
                return await this.makeRequest({
                    action: 'login',
                    username: username,
                    password: password
                });
            }

            async getAQIData() {
                return await this.makeRequest({
                    action: 'getAQIData'
                });
            }

            async submitComplaint(complaintData) {
                return await this.makeRequest({
                    action: 'submitComplaint',
                    data: JSON.stringify(complaintData)
                });
            }

            async getUserComplaints(userID) {
                return await this.makeRequest({
                    action: 'getUserComplaints',
                    userID: userID
                });
            }

            async getComplaintTracking(complaintID) {
                return await this.makeRequest({
                    action: 'getComplaintTracking',
                    complaintID: complaintID
                });
            }

            async getComplaintStats() {
                return await this.makeRequest({
                    action: 'getComplaintStats'
                });
            }

            async getSystemAnalytics() {
                return await this.makeRequest({
                    action: 'getSystemAnalytics'
                });
            }

            async getNotifications(userID) {
                return await this.makeRequest({
                    action: 'getNotifications',
                    userID: userID
                });
            }

            async getNearbyHospitals(lat, lng, radius = 10) {
                return await this.makeRequest({
                    action: 'getHospitals',
                    lat: lat,
                    lng: lng,
                    radius: radius
                });
            }

            async updateHealthProfile(userID, healthData) {
                return await this.makeRequest({
                    action: 'updateHealthProfile',
                    userID: userID,
                    healthData: JSON.stringify(healthData)
                });
            }

            async getHealthProfile(userID) {
                return await this.makeRequest({
                    action: 'getHealthProfile',
                    userID: userID
                });
            }

            async updateUserProfile(userID, profileData) {
                return await this.makeRequest({
                    action: 'updateUserProfile',
                    userID: userID,
                    profileData: JSON.stringify(profileData)
                });
            }
        }

        // Initialize backend service
        const backendService = new BackendService();

        // Main Application Class
        class AQIApplication {
            constructor() {
                this.currentUser = null;
                this.dashboard = new Dashboard();
                this.complaintManager = new ComplaintManager();
                this.mapManager = new MapManager();
                this.hospitalManager = new HospitalManager();
                this.analyticsManager = new AnalyticsManager();
                this.profileManager = new ProfileManager();
                this.notificationManager = new NotificationManager();
                this.autoRefreshInterval = null;
            }

            async initialize() {
                this.setupEventListeners();
                await this.checkAuthentication();
            }

            async checkAuthentication() {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.showDashboard();
                    await this.dashboard.initialize(this.currentUser);
                }
            }

            setupEventListeners() {
                // Authentication
                document.getElementById('loginForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.loginUser();
                });

                document.getElementById('registrationForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.registerUser();
                });

                // Navigation
                document.getElementById('login-tab').addEventListener('click', () => this.switchTab('login'));
                document.getElementById('register-tab').addEventListener('click', () => this.switchTab('register'));

                // Sidebar navigation
                document.querySelectorAll('.sidebar-menu a').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (e.target.id === 'logout-sidebar') {
                            this.logout();
                            return;
                        }
                        const section = e.target.getAttribute('data-section');
                        this.showSection(section);
                        
                        document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        if (window.innerWidth < 768) {
                            this.toggleSidebar();
                        }
                    });
                });

                // Header buttons
                document.getElementById('menuToggle').addEventListener('click', () => this.toggleSidebar());
                document.getElementById('sidebarOverlay').addEventListener('click', () => this.toggleSidebar());
                document.getElementById('notificationsBtn').addEventListener('click', () => this.toggleNotificationPanel());
                document.getElementById('profileBtn').addEventListener('click', () => this.toggleProfilePanel());

                // Logout from profile panel
                document.getElementById('logout-profile').addEventListener('click', () => this.logout());

                // Close panels when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.header-icon') && 
                        !e.target.closest('.notification-panel') && 
                        !e.target.closest('.profile-panel')) {
                        this.closePanels();
                    }
                });
            }

            async loginUser() {
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!username || !password) {
                    this.showAlert('Please enter username and password', 'error');
                    return;
                }

                const spinner = document.getElementById('login-spinner');
                spinner.style.display = 'inline-block';

                try {
                    const result = await backendService.login(username, password);
                    
                    spinner.style.display = 'none';

                    if (result.success) {
                        this.currentUser = result.userData;
                        localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                        this.showDashboard();
                        await this.dashboard.initialize(this.currentUser);
                        this.showAlert('Login successful!', 'success');
                    } else {
                        this.showAlert('Login failed: ' + result.error, 'error');
                    }
                } catch (error) {
                    spinner.style.display = 'none';
                    this.showAlert('Login error: ' + error.message, 'error');
                }
            }

            async registerUser() {
                const formData = {
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value,
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    mobile: document.getElementById('mobile').value,
                    healthProfile: {
                        respiratoryCondition: 'none',
                        cardiovascularCondition: false,
                        smoker: false,
                        activityLevel: 'moderate',
                        ageGroup: 'young'
                    }
                };

                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPasswordReg').value;
                
                if (password !== confirmPassword) {
                    this.showAlert('Passwords do not match', 'error');
                    return;
                }

                if (password.length < 6) {
                    this.showAlert('Password must be at least 6 characters long', 'error');
                    return;
                }

                const spinner = document.getElementById('register-spinner');
                spinner.style.display = 'inline-block';

                try {
                    const result = await backendService.register(formData);
                    
                    spinner.style.display = 'none';

                    if (result.success) {
                        this.showAlert('Registration successful! Please login.', 'success');
                        this.switchTab('login');
                        document.getElementById('registrationForm').reset();
                    } else {
                        this.showAlert('Registration failed: ' + result.error, 'error');
                    }
                } catch (error) {
                    spinner.style.display = 'none';
                    this.showAlert('Registration error: ' + error.message, 'error');
                }
            }

            showDashboard() {
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('dashboard-section').style.display = 'flex';
            }

            showSection(section) {
                document.querySelectorAll('.content-section').forEach(sec => {
                    sec.classList.remove('active');
                });
                
                const sectionElement = document.getElementById(`${section}-section-content`);
                if (sectionElement) {
                    sectionElement.classList.add('active');
                    
                    // Initialize section-specific functionality
                    this.initializeSection(section);
                }
            }

            initializeSection(section) {
                switch(section) {
                    case 'dashboard':
                        this.dashboard.loadDashboardData();
                        break;
                    case 'complaints':
                        this.complaintManager.initialize();
                        break;
                    case 'tracking':
                        this.complaintManager.loadUserComplaints();
                        break;
                    case 'map':
                        this.mapManager.initialize();
                        break;
                    case 'hospitals':
                        this.hospitalManager.initialize();
                        break;
                    case 'analytics':
                        this.analyticsManager.initialize();
                        break;
                    case 'profile':
                        this.profileManager.initialize();
                        break;
                }
            }

            toggleSidebar() {
                document.getElementById('sidebar').classList.toggle('open');
                document.getElementById('sidebarOverlay').classList.toggle('open');
            }

            toggleNotificationPanel() {
                document.getElementById('notificationPanel').classList.toggle('open');
                document.getElementById('profilePanel').classList.remove('open');
            }

            toggleProfilePanel() {
                document.getElementById('profilePanel').classList.toggle('open');
                document.getElementById('notificationPanel').classList.remove('open');
            }

            closePanels() {
                document.getElementById('notificationPanel').classList.remove('open');
                document.getElementById('profilePanel').classList.remove('open');
            }

            switchTab(tab) {
                if (tab === 'login') {
                    document.getElementById('login-tab').classList.add('active');
                    document.getElementById('register-tab').classList.remove('active');
                    document.getElementById('login-form').style.display = 'block';
                    document.getElementById('register-form').style.display = 'none';
                } else {
                    document.getElementById('register-tab').classList.add('active');
                    document.getElementById('login-tab').classList.remove('active');
                    document.getElementById('register-form').style.display = 'block';
                    document.getElementById('login-form').style.display = 'none';
                }
            }

            showAlert(message, type = 'info') {
                // Remove existing alerts
                const existingAlerts = document.querySelectorAll('.custom-alert');
                existingAlerts.forEach(alert => alert.remove());

                const alertClass = {
                    'success': 'alert-success',
                    'error': 'alert-danger',
                    'warning': 'alert-warning',
                    'info': 'alert-info'
                }[type] || 'alert-info';

                const alertHtml = `
                    <div class="alert ${alertClass} alert-dismissible fade show custom-alert" role="alert">
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;

                document.querySelector('.main-content').insertAdjacentHTML('afterbegin', alertHtml);
            }

            logout() {
                localStorage.removeItem('currentUser');
                this.currentUser = null;
                document.getElementById('dashboard-section').style.display = 'none';
                document.getElementById('auth-section').style.display = 'block';
                
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                }
                
                document.getElementById('loginForm').reset();
                this.switchTab('login');
            }
        }

        // Dashboard Management
        class Dashboard {
            constructor() {
                this.aqiData = null;
                this.weatherData = null;
                this.autoRefreshInterval = null;
            }

            async initialize(user) {
                this.currentUser = user;
                await this.loadDashboardData();
                this.startAutoRefresh();
                this.setupDashboardEventListeners();
            }

            async loadDashboardData() {
                try {
                    this.showLoadingStates();

                    const result = await backendService.getAQIData();
                    
                    if (result.success) {
                        this.aqiData = result.data;
                        this.weatherData = result.weather;
                        this.updateAQIDisplay(this.aqiData);
                        this.updateWeatherInfo(this.weatherData);
                        this.updatePollutantLevels(this.aqiData);
                        this.updateHealthRecommendations(this.aqiData);
                        
                        document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                    } else {
                        this.showError('Failed to load AQI data');
                    }

                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    this.showError('Unable to fetch real-time data');
                }
            }

            showLoadingStates() {
                document.getElementById('mainAQI').textContent = '--';
                document.getElementById('mainAQICategory').textContent = 'Loading...';
                document.getElementById('aqiDescription').textContent = 'Fetching real-time data...';
            }

            showError(message) {
                document.getElementById('mainAQI').textContent = 'Error';
                document.getElementById('mainAQICategory').textContent = 'Data unavailable';
                document.getElementById('aqiDescription').textContent = message;
            }

            updateAQIDisplay(aqiData) {
                const aqi = aqiData.aqi;
                const category = this.getAQICategory(aqi);
                const description = aqiData.healthMessage;
                
                document.getElementById('mainAQI').textContent = aqi;
                document.getElementById('mainAQICategory').textContent = category;
                document.getElementById('mainAQICategory').className = `badge fs-5 px-4 py-2 mb-4 ${this.getAQIClass(aqi)}`;
                document.getElementById('aqiDescription').textContent = description;
                document.getElementById('dominantPollutant').textContent = `Dominant Pollutant: ${aqiData.dominantPollutant || 'N/A'}`;
                
                // Update progress bar
                const progress = Math.min((aqi / 500) * 100, 100);
                document.getElementById('aqiProgress').style.width = `${progress}%`;
                document.getElementById('aqiProgress').className = `progress-bar ${this.getAQIClass(aqi)}`;
                
                // Show/hide health alert
                this.toggleHealthAlert(aqi);
            }

            getAQICategory(aqi) {
                if (aqi <= 50) return 'Good';
                if (aqi <= 100) return 'Satisfactory';
                if (aqi <= 200) return 'Moderate';
                if (aqi <= 300) return 'Poor';
                if (aqi <= 400) return 'Very Poor';
                return 'Severe';
            }

            getAQIClass(aqi) {
                if (aqi <= 50) return 'aqi-good';
                if (aqi <= 100) return 'aqi-satisfactory';
                if (aqi <= 200) return 'aqi-moderate';
                if (aqi <= 300) return 'aqi-poor';
                if (aqi <= 400) return 'aqi-very-poor';
                return 'aqi-severe';
            }

            toggleHealthAlert(aqi) {
                const alertElement = document.getElementById('healthAlert');
                const alertTitle = document.getElementById('alertTitle');
                const alertMessage = document.getElementById('alertMessage');
                
                if (aqi > 200) {
                    let title = 'Health Alert';
                    let message = 'Current air quality may affect sensitive individuals. Limit outdoor activities.';
                    
                    if (aqi > 300) {
                        title = 'High Health Alert';
                        message = 'Air quality is poor. Everyone may begin to experience health effects. Avoid outdoor activities.';
                    }
                    
                    if (aqi > 400) {
                        title = 'Severe Health Alert';
                        message = 'Health emergency! Avoid all outdoor activities. Sensitive groups should take extra precautions.';
                    }
                    
                    alertTitle.textContent = title;
                    alertMessage.textContent = message;
                    alertElement.style.display = 'block';
                } else {
                    alertElement.style.display = 'none';
                }
            }

            updateWeatherInfo(weatherData) {
                document.getElementById('temperature').textContent = `${weatherData.temperature}°C`;
                document.getElementById('humidity').textContent = `${weatherData.humidity}%`;
                document.getElementById('windSpeed').textContent = `${weatherData.windSpeed} m/s`;
                document.getElementById('visibility').textContent = `${weatherData.visibility} km`;
            }

            updatePollutantLevels(aqiData) {
                const pollutants = document.getElementById('pollutantLevels');
                
                const pollutantInfo = [
                    { name: 'PM2.5', value: aqiData.pm25, unit: 'μg/m³', max: 250, description: 'Fine particles' },
                    { name: 'PM10', value: aqiData.pm10, unit: 'μg/m³', max: 400, description: 'Coarse particles' },
                    { name: 'O₃', value: aqiData.o3, unit: 'ppb', max: 200, description: 'Ozone' },
                    { name: 'NO₂', value: aqiData.no2, unit: 'ppb', max: 150, description: 'Nitrogen Dioxide' },
                    { name: 'SO₂', value: aqiData.so2, unit: 'ppb', max: 100, description: 'Sulfur Dioxide' },
                    { name: 'CO', value: aqiData.co, unit: 'ppm', max: 10, description: 'Carbon Monoxide' }
                ];
                
                let pollutantsHtml = '';
                
                pollutantInfo.forEach(pollutant => {
                    if (pollutant.value > 0) {
                        const percentage = Math.min((pollutant.value / pollutant.max) * 100, 100);
                        const barColor = percentage < 50 ? 'bg-success' : percentage < 80 ? 'bg-warning' : 'bg-danger';
                        
                        pollutantsHtml += `
                            <div class="col-12 col-sm-6 col-lg-4 mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span><strong>${pollutant.name}</strong></span>
                                    <span class="badge bg-secondary">${pollutant.value} ${pollutant.unit}</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar ${barColor}" style="width: ${percentage}%"></div>
                                </div>
                                <small class="text-muted">${pollutant.description}</small>
                            </div>
                        `;
                    }
                });
                
                pollutants.innerHTML = pollutantsHtml || '<div class="col-12 text-center text-muted">No pollutant data available</div>';
            }

            updateHealthRecommendations(aqiData) {
                const aqi = aqiData.aqi;
                const recommendations = document.getElementById('healthRecommendations');
                const activities = document.getElementById('activitySuggestions');
                
                let healthHtml = '';
                let activityHtml = '';
                
                if (aqi <= 50) {
                    healthHtml = `
                        <ul class="mb-0">
                            <li>Air quality is good. Enjoy your normal activities.</li>
                            <li>No special precautions needed for most people.</li>
                            <li>Ideal day for outdoor exercise and activities.</li>
                        </ul>
                    `;
                    
                    activityHtml = `
                        <ul class="mb-0">
                            <li>Perfect for outdoor sports and activities</li>
                            <li>Great day for hiking or cycling</li>
                            <li>Ideal for opening windows for ventilation</li>
                        </ul>
                    `;
                } else if (aqi <= 100) {
                    healthHtml = `
                        <ul class="mb-0">
                            <li>Air quality is acceptable for most individuals.</li>
                            <li>Unusually sensitive people should consider reducing prolonged outdoor exertion.</li>
                            <li>People with asthma should have quick-relief medicine handy.</li>
                        </ul>
                    `;
                    
                    activityHtml = `
                        <ul class="mb-0">
                            <li>Generally safe for outdoor activities</li>
                            <li>Consider shorter duration for intense exercise</li>
                            <li>Good day for gardening or light outdoor work</li>
                        </ul>
                    `;
                } else if (aqi <= 200) {
                    healthHtml = `
                        <ul class="mb-0">
                            <li>People with heart or lung disease, older adults, and children should reduce prolonged outdoor exertion.</li>
                            <li>Everyone else should limit prolonged outdoor exertion.</li>
                            <li>Watch for symptoms like coughing or shortness of breath.</li>
                        </ul>
                    `;
                    
                    activityHtml = `
                        <ul class="mb-0">
                            <li>Limit intense outdoor activities</li>
                            <li>Consider indoor exercise options</li>
                            <li>Take more frequent breaks if working outdoors</li>
                        </ul>
                    `;
                } else {
                    healthHtml = `
                        <ul class="mb-0">
                            <li>Everyone should avoid all outdoor physical activity.</li>
                            <li>Sensitive groups should remain indoors.</li>
                            <li>Consider wearing an N95 mask if you must go outside.</li>
                            <li>Use air purifiers indoors and keep windows closed.</li>
                        </ul>
                    `;
                    
                    activityHtml = `
                        <ul class="mb-0">
                            <li>Avoid all outdoor physical activities</li>
                            <li>Reschedule outdoor events if possible</li>
                            <li>Use indoor fitness facilities instead</li>
                            <li>Keep windows and doors closed</li>
                        </ul>
                    `;
                }
                
                recommendations.innerHTML = healthHtml;
                activities.innerHTML = activityHtml;
            }

            setupDashboardEventListeners() {
                // Refresh button
                document.getElementById('refreshMap')?.addEventListener('click', () => {
                    this.loadDashboardData();
                });
            }

            startAutoRefresh() {
                // Refresh every 5 minutes
                this.autoRefreshInterval = setInterval(() => {
                    this.loadDashboardData();
                }, 300000);
            }

            stopAutoRefresh() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                }
            }
        }

        // Complaint Management
        class ComplaintManager {
            constructor() {
                this.cameraStream = null;
                this.capturedPhotos = [];
                this.locationMap = null;
                this.currentLocation = null;
            }

            async initialize() {
                this.setupComplaintForm();
                this.setupCamera();
                this.setupLocationMap();
            }

            setupComplaintForm() {
                const form = document.getElementById('complaintForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.submitComplaint();
                });

                // Location button
                document.getElementById('getCurrentLocation').addEventListener('click', () => {
                    this.getCurrentLocation();
                });

                // Refresh complaints button
                document.getElementById('refreshComplaints')?.addEventListener('click', () => {
                    this.loadUserComplaints();
                });
            }

            setupCamera() {
                const startCameraBtn = document.getElementById('startCamera');
                const capturePhotoBtn = document.getElementById('capturePhoto');
                const cameraPreview = document.getElementById('cameraPreview');

                startCameraBtn.addEventListener('click', async () => {
                    try {
                        this.cameraStream = await navigator.mediaDevices.getUserMedia({ 
                            video: { facingMode: 'environment' } 
                        });
                        
                        cameraPreview.innerHTML = '<video autoplay playsinline></video>';
                        const video = cameraPreview.querySelector('video');
                        video.srcObject = this.cameraStream;
                        
                        startCameraBtn.style.display = 'none';
                        capturePhotoBtn.style.display = 'block';
                    } catch (error) {
                        console.error('Camera error:', error);
                        alert('Unable to access camera. Please check permissions.');
                    }
                });

                capturePhotoBtn.addEventListener('click', () => {
                    this.capturePhoto();
                });
            }

            capturePhoto() {
                if (this.capturedPhotos.length >= 5) {
                    alert('Maximum 5 photos allowed');
                    return;
                }

                const video = document.querySelector('#cameraPreview video');
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                const photoData = canvas.toDataURL('image/jpeg', 0.8);
                this.capturedPhotos.push(photoData);
                this.updatePhotoPreview();
            }

            updatePhotoPreview() {
                const preview = document.getElementById('photoPreview');
                preview.innerHTML = '';

                this.capturedPhotos.forEach((photo, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-preview-item';
                    photoItem.innerHTML = `
                        <img src="${photo}" alt="Captured photo ${index + 1}">
                        <button type="button" class="photo-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    preview.appendChild(photoItem);
                });

                // Add remove event listeners
                preview.querySelectorAll('.photo-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.closest('.photo-remove').dataset.index);
                        this.capturedPhotos.splice(index, 1);
                        this.updatePhotoPreview();
                    });
                });
            }

            setupLocationMap() {
                this.locationMap = L.map('locationMap').setView([28.6139, 77.2090], 12);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(this.locationMap);

                let locationMarker = null;

                this.locationMap.on('click', (e) => {
                    const { lat, lng } = e.latlng;
                    this.currentLocation = { lat, lng };
                    
                    if (locationMarker) {
                        this.locationMap.removeLayer(locationMarker);
                    }
                    
                    locationMarker = L.marker([lat, lng]).addTo(this.locationMap)
                        .bindPopup('Selected Location')
                        .openPopup();
                    
                    document.getElementById('locationCoordinates').textContent = 
                        `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
                });
            }

            async getCurrentLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            this.currentLocation = { lat, lng };
                            
                            document.getElementById('complaintLocation').value = 
                                `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                            document.getElementById('locationCoordinates').textContent = 
                                `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
                            
                            // Show map and set view
                            document.getElementById('locationMap').style.display = 'block';
                            this.locationMap.setView([lat, lng], 15);
                            
                            if (this.locationMap) {
                                this.locationMap.eachLayer(layer => {
                                    if (layer instanceof L.Marker) {
                                        this.locationMap.removeLayer(layer);
                                    }
                                });
                                
                                L.marker([lat, lng]).addTo(this.locationMap)
                                    .bindPopup('Your Location')
                                    .openPopup();
                            }
                        },
                        (error) => {
                            alert('Unable to get your location. Please enter manually.');
                        }
                    );
                } else {
                    alert('Geolocation is not supported by this browser.');
                }
            }

            async submitComplaint() {
                try {
                    const complaintType = document.getElementById('complaintType').value;
                    const severity = document.getElementById('complaintSeverity').value;
                    const locationAddress = document.getElementById('complaintLocation').value;
                    const areaAffected = document.getElementById('areaAffected').value;
                    const peopleAffected = document.getElementById('peopleAffected').value;
                    const description = document.getElementById('complaintDescription').value;

                    if (!complaintType || !locationAddress || !description) {
                        alert('Please fill in all required fields');
                        return;
                    }

                    if (!this.currentLocation) {
                        alert('Please select a location on the map or use current location');
                        return;
                    }

                    if (this.capturedPhotos.length === 0) {
                        if (!confirm('No photos attached. Are you sure you want to submit without evidence?')) {
                            return;
                        }
                    }

                    const spinner = document.getElementById('complaint-spinner');
                    spinner.style.display = 'inline-block';

                    const complaintData = {
                        userID: app.currentUser.userID,
                        type: complaintType,
                        location: this.currentLocation,
                        locationAddress: locationAddress,
                        description: description,
                        photos: this.capturedPhotos,
                        severity: severity,
                        areaAffected: areaAffected,
                        peopleAffected: peopleAffected ? parseInt(peopleAffected) : 0
                    };

                    const result = await backendService.submitComplaint(complaintData);

                    spinner.style.display = 'none';

                    if (result.success) {
                        alert(`Complaint submitted successfully!\nTracking ID: ${result.complaintID}\nAssigned Officer: ${result.assignedOfficer}\nDepartment: ${result.assignedDepartment}`);
                        
                        // Reset form
                        document.getElementById('complaintForm').reset();
                        this.capturedPhotos = [];
                        this.updatePhotoPreview();
                        document.getElementById('locationMap').style.display = 'none';
                        this.currentLocation = null;
                        
                        // Stop camera
                        if (this.cameraStream) {
                            this.cameraStream.getTracks().forEach(track => track.stop());
                            this.cameraStream = null;
                        }
                        
                        // Reload complaints list
                        this.loadUserComplaints();
                    } else {
                        alert('Error submitting complaint: ' + result.error);
                    }

                } catch (error) {
                    console.error('Error submitting complaint:', error);
                    alert('Error submitting complaint. Please try again.');
                    document.getElementById('complaint-spinner').style.display = 'none';
                }
            }

            async loadUserComplaints() {
                try {
                    const complaintsList = document.getElementById('complaintsList');
                    complaintsList.innerHTML = '<div class="text-center text-muted py-4"><div class="loading-spinner"></div><p>Loading your complaints...</p></div>';

                    const result = await backendService.getUserComplaints(app.currentUser.userID);
                    
                    if (result.success) {
                        this.displayComplaints(result.complaints);
                        this.loadComplaintStats();
                    } else {
                        complaintsList.innerHTML = '<div class="text-center text-muted py-4"><p>Error loading complaints</p></div>';
                    }
                } catch (error) {
                    console.error('Error loading complaints:', error);
                    document.getElementById('complaintsList').innerHTML = '<div class="text-center text-muted py-4"><p>Error loading complaints</p></div>';
                }
            }

            displayComplaints(complaints) {
                const complaintsList = document.getElementById('complaintsList');
                
                if (complaints.length === 0) {
                    complaintsList.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-3x mb-3"></i>
                            <p>No complaints submitted yet</p>
                            <button class="btn btn-primary" onclick="showSection('complaints')">
                                <i class="fas fa-plus me-2"></i>Submit First Complaint
                            </button>
                        </div>
                    `;
                    return;
                }

                let complaintsHtml = '';
                
                complaints.forEach(complaint => {
                    const statusClass = `status-${complaint.status.toLowerCase().replace(' ', '-')}`;
                    const priorityClass = `priority-${complaint.priority.toLowerCase()}`;
                    
                    complaintsHtml += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h6 class="card-title mb-1">${this.getComplaintTypeDisplay(complaint.type)}</h6>
                                        <p class="card-text text-muted small mb-1">ID: ${complaint.complaintID}</p>
                                        <p class="card-text small">${complaint.description.substring(0, 100)}...</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="status-badge ${statusClass}">${complaint.status}</span>
                                        <span class="priority-badge ${priorityClass} mt-1 d-block">${complaint.priority}</span>
                                    </div>
                                </div>
                                
                                <div class="row small text-muted mb-2">
                                    <div class="col-6">
                                        <i class="fas fa-calendar me-1"></i>
                                        ${new Date(complaint.submittedAt).toLocaleDateString()}
                                    </div>
                                    <div class="col-6 text-end">
                                        <i class="fas fa-user-tie me-1"></i>
                                        ${complaint.officerAssigned || 'Not assigned'}
                                    </div>
                                </div>
                                
                                ${complaint.photoURLs && complaint.photoURLs.length > 0 ? `
                                <div class="photo-preview mb-2">
                                    ${complaint.photoURLs.slice(0, 3).map(url => `
                                        <div class="photo-preview-item">
                                            <img src="${url}" alt="Complaint photo" onclick="window.open('${url}', '_blank')">
                                        </div>
                                    `).join('')}
                                </div>
                                ` : ''}
                                
                                <button class="btn btn-outline-primary btn-sm" onclick="complaintManager.viewComplaintDetails('${complaint.complaintID}')">
                                    <i class="fas fa-eye me-1"></i>View Details
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                complaintsList.innerHTML = complaintsHtml;
            }

            getComplaintTypeDisplay(type) {
                const types = {
                    'construction': 'Illegal Construction',
                    'stubble': 'Stubble Burning',
                    'industry': 'Illegal Industry',
                    'vehicle': 'Vehicle Pollution',
                    'waste': 'Waste Burning'
                };
                return types[type] || type;
            }

            async loadComplaintStats() {
                try {
                    const result = await backendService.getComplaintStats();
                    
                    if (result.success) {
                        this.displayComplaintStats(result.stats);
                    }
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            }

            displayComplaintStats(stats) {
                const statsContainer = document.getElementById('complaintStats');
                
                statsContainer.innerHTML = `
                    <div class="text-center mb-3">
                        <div class="stat-number text-primary">${stats.total}</div>
                        <div class="stat-label">Total Complaints</div>
                    </div>
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="stat-number text-success">${stats.resolved}</div>
                            <div class="stat-label">Resolved</div>
                        </div>
                        <div class="col-6">
                            <div class="stat-number text-warning">${stats.pending}</div>
                            <div class="stat-label">Pending</div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar bg-success" style="width: ${stats.resolutionRate}%"></div>
                        </div>
                        <small class="text-muted">Resolution Rate: ${stats.resolutionRate}%</small>
                    </div>
                `;
            }

            async viewComplaintDetails(complaintID) {
                // Implementation for detailed complaint view
                alert(`Viewing details for complaint: ${complaintID}`);
                // This would open a modal or new section with detailed tracking information
            }
        }

        // Map Management
        class MapManager {
            constructor() {
                this.aqiMap = null;
                this.aqiStations = [];
                this.complaintLocations = [];
            }

            async initialize() {
                this.setupAQIMap();
                await this.loadMapData();
                this.setupMapControls();
            }

            setupAQIMap() {
                this.aqiMap = L.map('aqiMap').setView([28.6139, 77.2090], 10);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(this.aqiMap);

                // Add scale control
                L.control.scale().addTo(this.aqiMap);
            }

            async loadMapData() {
                await this.loadAQIStations();
                await this.loadComplaintLocations();
                await this.loadHospitals();
            }

            async loadAQIStations() {
                try {
                    const result = await backendService.getAQIData();
                    if (result.success) {
                        this.addAQIStation(result.data);
                    }
                } catch (error) {
                    console.error('Error loading AQI stations:', error);
                }
            }

            addAQIStation(aqiData) {
                const stationLat = 28.6139; // Delhi coordinates
                const stationLng = 77.2090;
                
                const aqi = aqiData.aqi;
                const category = this.getAQICategory(aqi);
                const markerColor = this.getMarkerColor(aqi);
                
                const circle = L.circleMarker([stationLat, stationLng], {
                    color: markerColor,
                    fillColor: markerColor,
                    fillOpacity: 0.7,
                    radius: 15
                }).addTo(this.aqiMap);
                
                circle.bindPopup(`
                    <div class="text-center">
                        <h6>Delhi Central Station</h6>
                        <div class="badge ${this.getAQIClass(aqi)}">AQI: ${aqi}</div>
                        <div class="mt-2">${category}</div>
                        <div class="small text-muted">Dominant: ${aqiData.dominantPollutant || 'N/A'}</div>
                    </div>
                `);
            }

            async loadComplaintLocations() {
                if (!app.currentUser) return;
                
                try {
                    const result = await backendService.getUserComplaints(app.currentUser.userID);
                    if (result.success) {
                        result.complaints.forEach(complaint => {
                            if (complaint.location.lat && complaint.location.lng) {
                                this.addComplaintMarker(complaint);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading complaint locations:', error);
                }
            }

            addComplaintMarker(complaint) {
                const marker = L.marker([complaint.location.lat, complaint.location.lng]).addTo(this.aqiMap);
                
                marker.bindPopup(`
                    <div>
                        <h6>${this.getComplaintTypeDisplay(complaint.type)}</h6>
                        <p class="mb-1"><strong>Status:</strong> ${complaint.status}</p>
                        <p class="mb-1"><strong>Priority:</strong> ${complaint.priority}</p>
                        <p class="mb-0"><strong>Submitted:</strong> ${new Date(complaint.submittedAt).toLocaleDateString()}</p>
                    </div>
                `);
            }

            async loadHospitals() {
                try {
                    const result = await backendService.getNearbyHospitals(28.6139, 77.2090, 20);
                    if (result.success) {
                        result.hospitals.forEach(hospital => {
                            this.addHospitalMarker(hospital);
                        });
                    }
                } catch (error) {
                    console.error('Error loading hospitals:', error);
                }
            }

            addHospitalMarker(hospital) {
                const marker = L.marker([hospital.lat, hospital.lng], {
                    icon: L.divIcon({
                        className: 'hospital-marker',
                        html: '<i class="fas fa-hospital text-success"></i>',
                        iconSize: [20, 20]
                    })
                }).addTo(this.aqiMap);
                
                marker.bindPopup(`
                    <div>
                        <h6>${hospital.name}</h6>
                        <p class="mb-1"><strong>Beds:</strong> ${hospital.beds}</p>
                        <p class="mb-1"><strong>Oxygen:</strong> ${hospital.oxygen ? 'Available' : 'Not Available'}</p>
                        <p class="mb-1"><strong>ICU:</strong> ${hospital.icu}</p>
                        <p class="mb-0"><strong>Distance:</strong> ${hospital.distance}</p>
                    </div>
                `);
            }

            setupMapControls() {
                document.getElementById('locateMe').addEventListener('click', () => {
                    this.locateUser();
                });

                document.getElementById('refreshMap').addEventListener('click', () => {
                    this.loadMapData();
                });
            }

            locateUser() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            
                            this.aqiMap.setView([lat, lng], 13);
                            
                            // Add user location marker
                            this.aqiMap.eachLayer(layer => {
                                if (layer instanceof L.Marker && layer._icon?.classList?.contains('user-location-marker')) {
                                    this.aqiMap.removeLayer(layer);
                                }
                            });
                            
                            L.marker([lat, lng], {
                                icon: L.divIcon({
                                    className: 'user-location-marker',
                                    html: '<i class="fas fa-user text-danger"></i>',
                                    iconSize: [20, 20]
                                })
                            }).addTo(this.aqiMap)
                              .bindPopup('Your Location')
                              .openPopup();
                        },
                        (error) => {
                            alert('Unable to get your location');
                        }
                    );
                } else {
                    alert('Geolocation is not supported by this browser.');
                }
            }

            getAQICategory(aqi) {
                if (aqi <= 50) return 'Good';
                if (aqi <= 100) return 'Satisfactory';
                if (aqi <= 200) return 'Moderate';
                if (aqi <= 300) return 'Poor';
                if (aqi <= 400) return 'Very Poor';
                return 'Severe';
            }

            getAQIClass(aqi) {
                if (aqi <= 50) return 'aqi-good';
                if (aqi <= 100) return 'aqi-satisfactory';
                if (aqi <= 200) return 'aqi-moderate';
                if (aqi <= 300) return 'aqi-poor';
                if (aqi <= 400) return 'aqi-very-poor';
                return 'aqi-severe';
            }

            getMarkerColor(aqi) {
                if (aqi <= 50) return '#28a745';
                if (aqi <= 100) return '#87c159';
                if (aqi <= 200) return '#ffc107';
                if (aqi <= 300) return '#fd7e14';
                if (aqi <= 400) return '#dc3545';
                return '#6f42c1';
            }

            getComplaintTypeDisplay(type) {
                const types = {
                    'construction': 'Illegal Construction',
                    'stubble': 'Stubble Burning',
                    'industry': 'Illegal Industry',
                    'vehicle': 'Vehicle Pollution',
                    'waste': 'Waste Burning'
                };
                return types[type] || type;
            }
        }

        // Hospital Management
        class HospitalManager {
            constructor() {
                this.hospitalsMap = null;
            }

            async initialize() {
                this.setupHospitalsMap();
                await this.loadHospitals();
                this.setupHospitalControls();
            }

            setupHospitalsMap() {
                this.hospitalsMap = L.map('hospitalsMap').setView([28.6139, 77.2090], 11);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(this.hospitalsMap);
            }

            async loadHospitals() {
                try {
                    const radius = document.getElementById('hospitalRadius').value;
                    const speciality = document.getElementById('hospitalSpeciality').value;
                    
                    const result = await backendService.getNearbyHospitals(28.6139, 77.2090, radius);
                    
                    if (result.success) {
                        this.displayHospitals(result.hospitals);
                        this.updateHospitalsMap(result.hospitals);
                    } else {
                        document.getElementById('hospitalsList').innerHTML = '<div class="text-center text-muted py-4"><p>Error loading hospitals</p></div>';
                    }
                } catch (error) {
                    console.error('Error loading hospitals:', error);
                    document.getElementById('hospitalsList').innerHTML = '<div class="text-center text-muted py-4"><p>Error loading hospitals</p></div>';
                }
            }

            displayHospitals(hospitals) {
                const hospitalsList = document.getElementById('hospitalsList');
                
                if (hospitals.length === 0) {
                    hospitalsList.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-hospital fa-3x mb-3"></i>
                            <p>No hospitals found in the selected area</p>
                        </div>
                    `;
                    return;
                }

                let hospitalsHtml = '';
                
                hospitals.forEach(hospital => {
                    hospitalsHtml += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h6 class="card-title mb-1">${hospital.name}</h6>
                                        <p class="card-text text-muted small mb-1">${hospital.address}</p>
                                        <p class="card-text small mb-1">
                                            <i class="fas fa-phone text-primary me-1"></i> ${hospital.phone}
                                        </p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-success">${hospital.distance}</span>
                                    </div>
                                </div>
                                
                                <div class="row small text-muted mb-2">
                                    <div class="col-4">
                                        <i class="fas fa-bed me-1"></i> ${hospital.beds} Beds
                                    </div>
                                    <div class="col-4">
                                        <i class="fas fa-lungs me-1"></i> ${hospital.oxygen ? 'Oxygen' : 'No Oxygen'}
                                    </div>
                                    <div class="col-4">
                                        <i class="fas fa-procedures me-1"></i> ${hospital.icu} ICU
                                    </div>
                                </div>
                                
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="hospitalManager.viewHospitalDetails('${hospital.id}')">
                                        <i class="fas fa-info-circle me-1"></i>Details
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" onclick="hospitalManager.directionsToHospital(${hospital.lat}, ${hospital.lng})">
                                        <i class="fas fa-directions me-1"></i>Directions
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                hospitalsList.innerHTML = hospitalsHtml;
            }

            updateHospitalsMap(hospitals) {
                // Clear existing markers
                this.hospitalsMap.eachLayer(layer => {
                    if (layer instanceof L.Marker) {
                        this.hospitalsMap.removeLayer(layer);
                    }
                });

                // Add hospital markers
                hospitals.forEach(hospital => {
                    const marker = L.marker([hospital.lat, hospital.lng]).addTo(this.hospitalsMap);
                    
                    marker.bindPopup(`
                        <div>
                            <h6>${hospital.name}</h6>
                            <p class="mb-1"><strong>Address:</strong> ${hospital.address}</p>
                            <p class="mb-1"><strong>Phone:</strong> ${hospital.phone}</p>
                            <p class="mb-1"><strong>Beds:</strong> ${hospital.beds}</p>
                            <p class="mb-0"><strong>Distance:</strong> ${hospital.distance}</p>
                        </div>
                    `);
                });

                // Adjust map bounds to show all hospitals
                if (hospitals.length > 0) {
                    const group = new L.featureGroup(hospitals.map(h => L.marker([h.lat, h.lng])));
                    this.hospitalsMap.fitBounds(group.getBounds().pad(0.1));
                }
            }

            setupHospitalControls() {
                document.getElementById('refreshHospitals').addEventListener('click', () => {
                    this.loadHospitals();
                });

                document.getElementById('hospitalRadius').addEventListener('change', () => {
                    this.loadHospitals();
                });

                document.getElementById('hospitalSpeciality').addEventListener('change', () => {
                    this.loadHospitals();
                });
            }

            viewHospitalDetails(hospitalId) {
                alert(`Viewing details for hospital: ${hospitalId}`);
                // This would open a modal with detailed hospital information
            }

            directionsToHospital(lat, lng) {
                const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
                window.open(url, '_blank');
            }
        }

        // Analytics Management
        class AnalyticsManager {
            constructor() {
                this.charts = {};
            }

            async initialize() {
                await this.loadAnalyticsData();
                this.setupAnalyticsControls();
            }

            async loadAnalyticsData() {
                try {
                    const result = await backendService.getSystemAnalytics();
                    
                    if (result.success) {
                        this.displayAnalytics(result.analytics);
                        this.createCharts(result.analytics);
                    } else {
                        console.error('Error loading analytics:', result.error);
                    }
                } catch (error) {
                    console.error('Error loading analytics:', error);
                }
            }

            displayAnalytics(analytics) {
                document.getElementById('totalComplaints').textContent = analytics.totalComplaints;
                document.getElementById('resolvedComplaints').textContent = analytics.resolvedComplaints;
                document.getElementById('pendingComplaints').textContent = analytics.pendingComplaints;
                document.getElementById('resolutionRate').textContent = analytics.resolutionRate;
            }

            createCharts(analytics) {
                this.createComplaintsByTypeChart(analytics.complaintsByType);
                this.createComplaintsByStatusChart(analytics.complaintsByStatus);
                this.createAQITrendChart(analytics.aqiTrend);
            }

            createComplaintsByTypeChart(complaintsByType) {
                const ctx = document.getElementById('complaintsByTypeChart').getContext('2d');
                
                if (this.charts.complaintsByType) {
                    this.charts.complaintsByType.destroy();
                }

                this.charts.complaintsByType = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Construction', 'Stubble Burning', 'Industry', 'Vehicle', 'Waste Burning'],
                        datasets: [{
                            data: [
                                complaintsByType.construction,
                                complaintsByType.stubble,
                                complaintsByType.industry,
                                complaintsByType.vehicle,
                                complaintsByType.waste
                            ],
                            backgroundColor: [
                                '#FF6384',
                                '#36A2EB',
                                '#FFCE56',
                                '#4BC0C0',
                                '#9966FF'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            createComplaintsByStatusChart(complaintsByStatus) {
                const ctx = document.getElementById('complaintsByStatusChart').getContext('2d');
                
                if (this.charts.complaintsByStatus) {
                    this.charts.complaintsByStatus.destroy();
                }

                this.charts.complaintsByStatus = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Submitted', 'In Progress', 'Under Investigation', 'Resolved'],
                        datasets: [{
                            data: [
                                complaintsByStatus.submitted,
                                complaintsByStatus['in-progress'],
                                complaintsByStatus['under-investigation'],
                                complaintsByStatus.resolved
                            ],
                            backgroundColor: [
                                '#6c757d',
                                '#0dcaf0',
                                '#ffc107',
                                '#198754'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            createAQITrendChart(aqiTrend) {
                const ctx = document.getElementById('aqiTrendChart').getContext('2d');
                
                if (this.charts.aqiTrend) {
                    this.charts.aqiTrend.destroy();
                }

                const dates = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    dates.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                }

                this.charts.aqiTrend = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'AQI',
                            data: aqiTrend,
                            borderColor: '#0d6efd',
                            backgroundColor: 'rgba(13, 110, 253, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }

            setupAnalyticsControls() {
                document.getElementById('refreshAnalytics').addEventListener('click', () => {
                    this.loadAnalyticsData();
                });

                document.getElementById('exportData').addEventListener('click', () => {
                    this.exportData();
                });
            }

            exportData() {
                alert('Export functionality would be implemented here');
                // This would generate and download a CSV or PDF report
            }
        }

        // Profile Management
        class ProfileManager {
            constructor() {
                // Initialize in the initialize method
            }

            async initialize() {
                this.setupProfileForms();
                await this.loadProfileData();
                this.setupProfileControls();
            }

            setupProfileForms() {
                document.getElementById('profileForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.updateProfile();
                });

                document.getElementById('healthProfileForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.updateHealthProfile();
                });

                document.getElementById('saveNotifications').addEventListener('click', () => {
                    this.saveNotificationPreferences();
                });
            }

            async loadProfileData() {
                if (!app.currentUser) return;

                // Load user profile
                document.getElementById('profileFullName').value = app.currentUser.fullName || '';
                document.getElementById('profileUsername').value = app.currentUser.username || '';
                document.getElementById('profileEmail').value = app.currentUser.email || '';
                document.getElementById('profileMobile').value = app.currentUser.mobile || '';
                document.getElementById('profileAddress').value = app.currentUser.address || '';
                document.getElementById('profileCity').value = app.currentUser.city || '';
                document.getElementById('profileState').value = app.currentUser.state || '';
                document.getElementById('profilePincode').value = app.currentUser.pincode || '';

                // Update profile panel
                document.getElementById('profileUserName').textContent = app.currentUser.fullName || app.currentUser.username;
                document.getElementById('profileUserLocation').textContent = `${app.currentUser.city || ''}, ${app.currentUser.state || ''}`.trim() || 'Delhi, India';

                // Load health profile
                try {
                    const result = await backendService.getHealthProfile(app.currentUser.userID);
                    
                    if (result.success) {
                        const healthProfile = result.healthProfile;
                        
                        document.getElementById('respiratoryCondition').value = healthProfile.respiratoryCondition || 'none';
                        document.getElementById('ageGroup').value = healthProfile.ageGroup || 'young';
                        document.getElementById('activityLevel').value = healthProfile.activityLevel || 'moderate';
                        document.getElementById('bloodGroup').value = healthProfile.bloodGroup || '';
                        document.getElementById('emergencyContact').value = healthProfile.emergencyContact || '';
                        document.getElementById('cardiovascularCondition').checked = healthProfile.cardiovascularCondition || false;
                        document.getElementById('smoker').checked = healthProfile.smoker || false;
                    }
                } catch (error) {
                    console.error('Error loading health profile:', error);
                }
            }

            async updateProfile() {
                try {
                    const profileData = {
                        fullName: document.getElementById('profileFullName').value,
                        email: document.getElementById('profileEmail').value,
                        mobile: document.getElementById('profileMobile').value,
                        address: document.getElementById('profileAddress').value,
                        city: document.getElementById('profileCity').value,
                        state: document.getElementById('profileState').value,
                        pincode: document.getElementById('profilePincode').value
                    };

                    const spinner = document.getElementById('profile-spinner');
                    spinner.style.display = 'inline-block';

                    // In a real app, this would call the backend
                    // For now, we'll just update the local user data
                    Object.assign(app.currentUser, profileData);
                    localStorage.setItem('currentUser', JSON.stringify(app.currentUser));

                    setTimeout(() => {
                        spinner.style.display = 'none';
                        app.showAlert('Profile updated successfully!', 'success');
                        this.loadProfileData(); // Refresh the displayed data
                    }, 1000);

                } catch (error) {
                    console.error('Error updating profile:', error);
                    document.getElementById('profile-spinner').style.display = 'none';
                    app.showAlert('Error updating profile', 'error');
                }
            }

            async updateHealthProfile() {
                try {
                    const healthData = {
                        respiratoryCondition: document.getElementById('respiratoryCondition').value,
                        cardiovascularCondition: document.getElementById('cardiovascularCondition').checked,
                        smoker: document.getElementById('smoker').checked,
                        activityLevel: document.getElementById('activityLevel').value,
                        ageGroup: document.getElementById('ageGroup').value,
                        bloodGroup: document.getElementById('bloodGroup').value,
                        emergencyContact: document.getElementById('emergencyContact').value
                    };

                    const spinner = document.getElementById('health-spinner');
                    spinner.style.display = 'inline-block';

                    const result = await backendService.updateHealthProfile(app.currentUser.userID, healthData);

                    spinner.style.display = 'none';

                    if (result.success) {
                        app.showAlert('Health profile updated successfully!', 'success');
                    } else {
                        app.showAlert('Error updating health profile: ' + result.error, 'error');
                    }

                } catch (error) {
                    console.error('Error updating health profile:', error);
                    document.getElementById('health-spinner').style.display = 'none';
                    app.showAlert('Error updating health profile', 'error');
                }
            }

            saveNotificationPreferences() {
                const preferences = {
                    email: document.getElementById('emailNotifications').checked,
                    sms: document.getElementById('smsNotifications').checked,
                    aqiAlerts: document.getElementById('aqiAlerts').checked,
                    complaintUpdates: document.getElementById('complaintUpdates').checked
                };

                // In a real app, this would save to the backend
                localStorage.setItem('notificationPreferences', JSON.stringify(preferences));
                app.showAlert('Notification preferences saved!', 'success');
            }

            setupProfileControls() {
                document.getElementById('changePassword').addEventListener('click', () => {
                    this.changePassword();
                });

                document.getElementById('deleteAccount').addEventListener('click', () => {
                    this.deleteAccount();
                });

                // Load saved notification preferences
                const savedPreferences = localStorage.getItem('notificationPreferences');
                if (savedPreferences) {
                    const preferences = JSON.parse(savedPreferences);
                    document.getElementById('emailNotifications').checked = preferences.email;
                    document.getElementById('smsNotifications').checked = preferences.sms;
                    document.getElementById('aqiAlerts').checked = preferences.aqiAlerts;
                    document.getElementById('complaintUpdates').checked = preferences.complaintUpdates;
                }
            }

            changePassword() {
                const newPassword = prompt('Enter new password:');
                if (newPassword && newPassword.length >= 6) {
                    app.showAlert('Password changed successfully!', 'success');
                } else if (newPassword) {
                    app.showAlert('Password must be at least 6 characters long', 'error');
                }
            }

            deleteAccount() {
                if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                    app.logout();
                    app.showAlert('Account deleted successfully', 'success');
                }
            }
        }

        // Notification Management
        class NotificationManager {
            constructor() {
                this.notifications = [];
            }

            async initialize() {
                await this.loadNotifications();
                this.setupNotificationPanel();
            }

            async loadNotifications() {
                if (!app.currentUser) return;
                
                try {
                    const result = await backendService.getNotifications(app.currentUser.userID);
                    if (result.success) {
                        this.notifications = result.notifications;
                        this.updateNotificationDisplay();
                    }
                } catch (error) {
                    console.error('Error loading notifications:', error);
                }
            }

            updateNotificationDisplay() {
                const countElement = document.getElementById('notificationCount');
                const panelContent = document.getElementById('notificationPanelContent');
                
                countElement.textContent = this.notifications.length.toString();
                
                if (this.notifications.length === 0) {
                    panelContent.innerHTML = '<div class="text-center text-muted py-4"><p>No new notifications</p></div>';
                    return;
                }
                
                let notificationsHtml = '';
                
                this.notifications.forEach(notification => {
                    const timeAgo = this.getTimeAgo(notification.createdAt);
                    const icon = this.getNotificationIcon(notification.type);
                    
                    notificationsHtml += `
                        <div class="notification-item" data-id="${notification.id}">
                            <div class="d-flex align-items-start">
                                <div class="me-3 text-${this.getNotificationColor(notification.type)}">
                                    <i class="${icon} fa-lg"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-bold">${notification.title}</div>
                                    <div class="small text-muted">${notification.message}</div>
                                    <div class="small text-muted">${timeAgo}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                panelContent.innerHTML = notificationsHtml;
            }

            getTimeAgo(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins} minutes ago`;
                if (diffHours < 24) return `${diffHours} hours ago`;
                return `${diffDays} days ago`;
            }

            getNotificationIcon(type) {
                const icons = {
                    'info': 'fas fa-info-circle',
                    'alert': 'fas fa-exclamation-triangle',
                    'assignment': 'fas fa-user-tie',
                    'status_update': 'fas fa-sync-alt',
                    'health_alert': 'fas fa-heartbeat'
                };
                return icons[type] || 'fas fa-bell';
            }

            getNotificationColor(type) {
                const colors = {
                    'info': 'info',
                    'alert': 'warning',
                    'assignment': 'primary',
                    'status_update': 'success',
                    'health_alert': 'danger'
                };
                return colors[type] || 'secondary';
            }

            setupNotificationPanel() {
                document.getElementById('markAllRead').addEventListener('click', () => {
                    this.markAllAsRead();
                });
            }

            markAllAsRead() {
                this.notifications = [];
                this.updateNotificationDisplay();
                // In a real app, you would call backend to mark as read
            }
        }

        // Utility Functions
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.parentElement.querySelector('.password-toggle i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            const sectionElement = document.getElementById(`${section}-section-content`);
            if (sectionElement) {
                sectionElement.classList.add('active');
                
                // Initialize section-specific functionality
                app.initializeSection(section);
            }
        }

        // Global instances
        const app = new AQIApplication();
        const complaintManager = new ComplaintManager();
        const mapManager = new MapManager();
        const hospitalManager = new HospitalManager();
        const analyticsManager = new AnalyticsManager();
        const profileManager = new ProfileManager();
        const notificationManager = new NotificationManager();

        // Initialize application
        document.addEventListener('DOMContentLoaded', async function() {
            await app.initialize();
        });
    </script>
</body>
</html>
